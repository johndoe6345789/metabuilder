{
  "version":"2.2.0","name":"Create User","description":"Create new user with email verification","trigger":{"type":"http","method":"POST","path":"/users"},"nodes":[{"id":"check_permission","type":"operation","op":"condition","condition":"{{ $context.user.level >= 3 }}"},{"id":"validate_input","type":"operation","op":"validate","input":"{{ $json }}","rules":{"email":"required|email|unique:User","displayName":"required|string"}},{"id":"hash_password","type":"operation","op":"crypto","operation":"bcrypt_hash","input":"{{ $json.password || $utils.generateSecurePassword() }}","rounds":12},{"id":"create_user","type":"operation","op":"database_create","entity":"User","data":{"email":"{{ $json.email }}","displayName":"{{ $json.displayName }}","passwordHash":"{{ $steps.hash_password.output }}","tenantId":"{{ $context.tenantId }}","level":"{{ $json.level || 0 }}","isActive":true}},{"id":"send_welcome_email","type":"operation","op":"email_send","to":"{{ $json.email }}","subject":"Welcome","template":"user_welcome"},{"id":"return_success","type":"action","action":"http_response","status":201,"body":{"id":"{{ $steps.create_user.output.id }}","email":"{{ $json.email }}"}}]
}
