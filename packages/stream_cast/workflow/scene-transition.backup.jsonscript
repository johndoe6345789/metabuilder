{
  "version":"2.2.0","name":"Handle Scene Transition","description":"Update stream scene and broadcast to viewers","trigger":{"type":"http","method":"POST","path":"/streams/:channelId/scenes/:sceneId/activate"},"nodes":[{"id":"validate_context","type":"operation","op":"validate","input":"{{ $context.user.id }}","validator":"required"},{"id":"check_authorization","type":"operation","op":"condition","condition":"{{ $context.user.level >= 2 }}"},{"id":"fetch_channel","type":"operation","op":"database_read","entity":"StreamChannel","params":{"filter":{"id":"{{ $json.channelId }}","tenantId":"{{ $context.tenantId }}"}}},{"id":"update_active_scene","type":"operation","op":"database_update","entity":"StreamChannel","params":{"filter":{"id":"{{ $json.channelId }}"},"data":{"activeSceneId":"{{ $json.sceneId }}","sceneChangedAt":"{{ new Date().toISOString() }}"}}},{"id":"emit_scene_change","type":"action","action":"emit_event","event":"scene_changed","channel":"{{ 'stream:' + $json.channelId }}","data":{"sceneId":"{{ $json.sceneId }}","transitionTime":"{{ new Date().toISOString() }}"}},{"id":"return_success","type":"action","action":"http_response","status":200,"body":{"message":"Scene updated"}}]
}
