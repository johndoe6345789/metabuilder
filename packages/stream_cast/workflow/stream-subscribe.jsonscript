{
  "version":"2.2.0","name":"Subscribe to Stream","description":"Subscribe user to stream updates via SSE","trigger":{"type":"http","method":"GET","path":"/streams/:channelId/subscribe"},"nodes":[{"id":"validate_context","type":"operation","op":"validate","input":"{{ $context.user.id }}","validator":"required"},{"id":"fetch_channel","type":"operation","op":"database_read","entity":"StreamChannel","params":{"filter":{"id":"{{ $json.channelId }}","tenantId":"{{ $context.tenantId }}"}}},{"id":"create_subscription","type":"operation","op":"database_create","entity":"StreamSubscription","data":{"channelId":"{{ $json.channelId }}","userId":"{{ $context.user.id }}","tenantId":"{{ $context.tenantId }}","subscribedAt":"{{ new Date().toISOString() }}"}},{"id":"setup_sse","type":"action","action":"sse_stream","channel":"{{ 'stream:' + $json.channelId }}","onConnect":"{{ { subscriptionId: $steps.create_subscription.output.id } }}"}]
}
