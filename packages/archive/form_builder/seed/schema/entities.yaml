# Form Builder Schema Definitions
# Package: form_builder
# Version: 1.0.0

entities:
  - name: Form
    description: Form definition with fields and validation
    fields:
      - name: id
        type: String
        required: true
        primary: true
      - name: tenantId
        type: String
        required: true
      - name: name
        type: String
        required: true
      - name: description
        type: String
        required: false
      - name: fields
        type: Json
        required: true
        description: Array of field definitions
      - name: settings
        type: Json
        required: false
        description: Form-level settings
      - name: validationRules
        type: Json
        required: false
        description: Custom validation rules
      - name: isActive
        type: Boolean
        required: true
        default: true
      - name: version
        type: Int
        required: true
        default: 1
      - name: submissionCount
        type: Int
        required: true
        default: 0
      - name: createdAt
        type: DateTime
        required: true
      - name: updatedAt
        type: DateTime
        required: true
    indexes:
      - name: form_tenant_name_idx
        fields: [tenantId, name]
      - name: form_tenant_active_idx
        fields: [tenantId, isActive]
    acl:
      create: [moderator, admin]
      read: [user, admin]
      update: [moderator, admin]
      delete: [admin]

  - name: FormSubmission
    description: Submitted form response
    fields:
      - name: id
        type: String
        required: true
        primary: true
      - name: tenantId
        type: String
        required: true
      - name: formId
        type: String
        required: true
      - name: userId
        type: String
        required: false
        description: Null for anonymous submissions
      - name: data
        type: Json
        required: true
        description: Submitted form data
      - name: metadata
        type: Json
        required: false
        description: Submission metadata (IP, user agent, etc.)
      - name: status
        type: String
        required: true
        default: submitted
        description: submitted, reviewed, approved, rejected
      - name: reviewNotes
        type: String
        required: false
      - name: reviewedAt
        type: DateTime
        required: false
      - name: submittedAt
        type: DateTime
        required: true
    indexes:
      - name: submission_form_idx
        fields: [formId]
      - name: submission_form_status_idx
        fields: [formId, status]
      - name: submission_user_idx
        fields: [userId]
    relations:
      - name: form
        type: belongsTo
        target: Form
        foreignKey: formId
    acl:
      create: [public, user]
      read: [owner, moderator, admin]
      update: [moderator, admin]
      delete: [admin]
