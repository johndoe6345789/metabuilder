# Schema definitions owned by media_center package

entities:
  - name: MediaAsset
    version: "1.0"
    description: "Media file asset (images, videos, audio, documents)"
    checksum: null
    
    fields:
      id:
        type: cuid
        primary: true
        generated: true
        
      tenantId:
        type: string
        required: true
        index: true
        
      userId:
        type: string
        required: true
        index: true
        
      filename:
        type: string
        required: true
        
      originalName:
        type: string
        required: true
        
      mimeType:
        type: string
        required: true
        index: true
        
      size:
        type: bigint
        required: true
        
      path:
        type: string
        required: true
        
      thumbnailPath:
        type: string
        nullable: true
        
      width:
        type: int
        nullable: true
        
      height:
        type: int
        nullable: true
        
      duration:
        type: int
        nullable: true
        description: "Audio/video duration in seconds"
        
      metadata:
        type: string
        nullable: true
        description: "JSON: EXIF, tags, etc."
        
      createdAt:
        type: bigint
        required: true

    indexes:
      - fields: [tenantId]
      - fields: [userId]
      - fields: [mimeType]

    relations:
      - name: tenant
        type: belongsTo
        entity: Tenant
        field: tenantId
        onDelete: Cascade
      - name: user
        type: belongsTo
        entity: User
        field: userId
        onDelete: Cascade

    acl:
      create: [user]
      read: [self, admin]
      update: [self]
      delete: [self, admin]
      rowLevel: "userId = $user.id"

  - name: MediaJob
    version: "1.0"
    description: "Background media processing job"
    checksum: null
    
    fields:
      id:
        type: cuid
        primary: true
        generated: true
        
      tenantId:
        type: string
        required: true
        index: true
        
      userId:
        type: string
        required: true
        index: true
        
      type:
        type: string
        required: true
        enum: [transcode, thumbnail, convert, compress, analyze]
        
      status:
        type: string
        required: true
        default: "pending"
        enum: [pending, processing, completed, failed, cancelled]
        index: true
        
      priority:
        type: int
        default: 0
        
      inputPath:
        type: string
        required: true
        
      outputPath:
        type: string
        nullable: true
        
      params:
        type: string
        required: true
        description: "JSON: job-specific parameters"
        
      progress:
        type: int
        default: 0
        
      error:
        type: string
        nullable: true
        
      startedAt:
        type: bigint
        nullable: true
        
      completedAt:
        type: bigint
        nullable: true
        
      createdAt:
        type: bigint
        required: true

    indexes:
      - fields: [tenantId]
      - fields: [status, priority]
      - fields: [userId]

    acl:
      create: [user, system]
      read: [self, admin]
      update: [system, admin]
      delete: [admin]
      rowLevel: "userId = $user.id"
