# SMTP Config Schema Definitions
# Package: smtp_config
# Version: 1.0.0

entities:
  - name: SmtpConfig
    description: SMTP server configuration
    fields:
      - name: id
        type: String
        required: true
        primary: true
      - name: tenantId
        type: String
        required: true
      - name: name
        type: String
        required: true
      - name: host
        type: String
        required: true
      - name: port
        type: Int
        required: true
      - name: secure
        type: Boolean
        required: true
        default: true
      - name: username
        type: String
        required: false
      - name: password
        type: String
        required: false
        description: Encrypted password
      - name: fromAddress
        type: String
        required: true
      - name: fromName
        type: String
        required: false
      - name: isDefault
        type: Boolean
        required: true
        default: false
      - name: isActive
        type: Boolean
        required: true
        default: true
      - name: createdAt
        type: DateTime
        required: true
      - name: updatedAt
        type: DateTime
        required: true
    indexes:
      - name: smtp_tenant_name_idx
        fields: [tenantId, name]
        unique: true
      - name: smtp_tenant_default_idx
        fields: [tenantId, isDefault]
    acl:
      create: [admin]
      read: [admin]
      update: [admin]
      delete: [admin]

  - name: EmailTemplate
    description: Email template definition
    fields:
      - name: id
        type: String
        required: true
        primary: true
      - name: tenantId
        type: String
        required: true
      - name: name
        type: String
        required: true
      - name: slug
        type: String
        required: true
        description: Unique template identifier
      - name: subject
        type: String
        required: true
      - name: bodyHtml
        type: String
        required: true
      - name: bodyText
        type: String
        required: false
        description: Plain text fallback
      - name: variables
        type: Json
        required: false
        description: Available template variables
      - name: isActive
        type: Boolean
        required: true
        default: true
      - name: createdAt
        type: DateTime
        required: true
      - name: updatedAt
        type: DateTime
        required: true
    indexes:
      - name: template_tenant_slug_idx
        fields: [tenantId, slug]
        unique: true
    acl:
      create: [admin]
      read: [admin]
      update: [admin]
      delete: [admin]

  - name: EmailLog
    description: Sent email log
    fields:
      - name: id
        type: String
        required: true
        primary: true
      - name: tenantId
        type: String
        required: true
      - name: configId
        type: String
        required: true
      - name: templateId
        type: String
        required: false
      - name: toAddress
        type: String
        required: true
      - name: subject
        type: String
        required: true
      - name: status
        type: String
        required: true
        description: pending, sent, failed, bounced
      - name: error
        type: String
        required: false
      - name: messageId
        type: String
        required: false
        description: SMTP message ID
      - name: metadata
        type: Json
        required: false
      - name: sentAt
        type: DateTime
        required: false
      - name: createdAt
        type: DateTime
        required: true
    indexes:
      - name: email_log_tenant_idx
        fields: [tenantId]
      - name: email_log_status_idx
        fields: [tenantId, status]
      - name: email_log_to_idx
        fields: [tenantId, toAddress]
    relations:
      - name: config
        type: belongsTo
        target: SmtpConfig
        foreignKey: configId
    acl:
      create: [system]
      read: [admin]
      update: [system]
      delete: [admin]
