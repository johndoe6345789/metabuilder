# yaml-language-server: $schema=../../../../../schemas/yaml-schema.yaml
# Schema definitions owned by forum_forge package

entities:
  - name: ForumCategory
    version: "1.0"
    description: "Forum category for organizing discussion threads"
    checksum: null
    
    fields:
      id:
        type: cuid
        primary: true
        generated: true
        
      tenantId:
        type: string
        required: true
        index: true
        
      name:
        type: string
        required: true
        maxLength: 100
        
      description:
        type: string
        nullable: true
        
      icon:
        type: string
        nullable: true
        
      slug:
        type: string
        required: true
        maxLength: 100
        
      sortOrder:
        type: int
        default: 0
        
      parentId:
        type: string
        nullable: true
        index: true
        
      createdAt:
        type: bigint
        required: true

    indexes:
      - fields: [tenantId, slug]
        unique: true
      - fields: [tenantId]
      - fields: [parentId]

    relations:
      - name: tenant
        type: belongsTo
        entity: Tenant
        field: tenantId
        onDelete: Cascade
      - name: threads
        type: hasMany
        entity: ForumThread
        foreignKey: categoryId

    acl:
      create: [admin]
      read: [public]
      update: [admin]
      delete: [admin]

  - name: ForumThread
    version: "1.0"
    description: "Forum discussion thread"
    checksum: null
    
    fields:
      id:
        type: cuid
        primary: true
        generated: true
        
      tenantId:
        type: string
        required: true
        index: true
        
      categoryId:
        type: string
        required: true
        index: true
        
      authorId:
        type: string
        required: true
        index: true
        
      title:
        type: string
        required: true
        maxLength: 200
        
      content:
        type: string
        required: true
        
      slug:
        type: string
        required: true
        
      isPinned:
        type: boolean
        default: false
        
      isLocked:
        type: boolean
        default: false
        
      viewCount:
        type: int
        default: 0
        
      replyCount:
        type: int
        default: 0
        
      lastReplyAt:
        type: bigint
        nullable: true
        
      lastReplyBy:
        type: string
        nullable: true
        
      createdAt:
        type: bigint
        required: true
        
      updatedAt:
        type: bigint
        nullable: true

    indexes:
      - fields: [tenantId, slug]
        unique: true
      - fields: [tenantId]
      - fields: [categoryId]
      - fields: [authorId]
      - fields: [isPinned, lastReplyAt]

    relations:
      - name: category
        type: belongsTo
        entity: ForumCategory
        field: categoryId
        onDelete: Cascade
      - name: author
        type: belongsTo
        entity: User
        field: authorId
        onDelete: Cascade
      - name: posts
        type: hasMany
        entity: ForumPost
        foreignKey: threadId

    acl:
      create: [user]
      read: [public]
      update: [self, moderator]
      delete: [self, moderator]
      rowLevel: "authorId = $user.id"

  - name: ForumPost
    version: "1.0"
    description: "Forum reply/post within a thread"
    checksum: null
    
    fields:
      id:
        type: cuid
        primary: true
        generated: true
        
      tenantId:
        type: string
        required: true
        index: true
        
      threadId:
        type: string
        required: true
        index: true
        
      authorId:
        type: string
        required: true
        index: true
        
      content:
        type: string
        required: true
        
      likes:
        type: int
        default: 0
        
      isEdited:
        type: boolean
        default: false
        
      createdAt:
        type: bigint
        required: true
        
      updatedAt:
        type: bigint
        nullable: true

    indexes:
      - fields: [tenantId]
      - fields: [threadId]
      - fields: [authorId]

    relations:
      - name: thread
        type: belongsTo
        entity: ForumThread
        field: threadId
        onDelete: Cascade
      - name: author
        type: belongsTo
        entity: User
        field: authorId
        onDelete: Cascade

    acl:
      create: [user]
      read: [public]
      update: [self, moderator]
      delete: [self, moderator]
      rowLevel: "authorId = $user.id"
