{
  "name": "List Package Versions",
  "description": "List all versions of a package",
  "version": "1.0.0",
  "nodes": [
    {
      "id": "parse_path",
      "type": "packagerepo.parse_path",
      "parameters": {
        "path": "$request.path",
        "pattern": "/v1/:namespace/:name/versions",
        "out": "entity"
      }
    },
    {
      "id": "normalize",
      "type": "packagerepo.normalize_entity",
      "parameters": {
        "entity": "$entity",
        "out": "normalized"
      }
    },
    {
      "id": "query_index",
      "type": "packagerepo.index_query",
      "parameters": {
        "key": "$entity.namespace/$entity.name",
        "out": "versions"
      }
    },
    {
      "id": "check_exists",
      "type": "logic.if",
      "parameters": {
        "condition": "$versions == null",
        "then": "error_not_found",
        "else": "enrich_versions"
      }
    },
    {
      "id": "enrich_versions",
      "type": "packagerepo.enrich_version_list",
      "parameters": {
        "namespace": "$entity.namespace",
        "name": "$entity.name",
        "versions": "$versions",
        "out": "enriched"
      }
    },
    {
      "id": "respond_json",
      "type": "packagerepo.respond_json",
      "parameters": {
        "body": {
          "namespace": "$entity.namespace",
          "name": "$entity.name",
          "versions": "$enriched"
        },
        "status": 200
      }
    },
    {
      "id": "error_not_found",
      "type": "packagerepo.respond_error",
      "parameters": {
        "message": "Package not found",
        "status": 404
      }
    }
  ]
}
