{
  "name": "Download Artifact",
  "active": false,
  "nodes": [
    {
      "id": "parse_path",
      "name": "Parse Path",
      "type": "packagerepo.parse_path",
      "typeVersion": 1,
      "position": [
        100,
        100
      ],
      "parameters": {
        "name": "Parse Path",
        "typeVersion": 1,
        "position": [
          100,
          100
        ],
        "parameters": {
          "parameters": {
            "path": "$request.path",
            "pattern": "/v1/:namespace/:name/:version/:variant/blob",
            "out": "entity"
          }
        }
      }
    },
    {
      "id": "normalize",
      "name": "Normalize",
      "type": "packagerepo.normalize_entity",
      "typeVersion": 1,
      "position": [
        400,
        100
      ],
      "parameters": {
        "name": "Normalize",
        "typeVersion": 1,
        "position": [
          400,
          100
        ],
        "parameters": {
          "parameters": {
            "entity": "$entity",
            "out": "normalized"
          }
        }
      }
    },
    {
      "id": "get_meta",
      "name": "Get Meta",
      "type": "packagerepo.kv_get",
      "typeVersion": 1,
      "position": [
        700,
        100
      ],
      "parameters": {
        "name": "Get Meta",
        "typeVersion": 1,
        "position": [
          700,
          100
        ],
        "parameters": {
          "parameters": {
            "key": "artifact/$entity.namespace/$entity.name/$entity.version/$entity.variant",
            "out": "metadata"
          }
        }
      }
    },
    {
      "id": "check_exists",
      "name": "Check Exists",
      "type": "logic.if",
      "typeVersion": 1,
      "position": [
        100,
        300
      ],
      "parameters": {
        "name": "Check Exists",
        "typeVersion": 1,
        "position": [
          100,
          300
        ],
        "parameters": {
          "parameters": {
            "condition": "$metadata == null",
            "then": "error_not_found",
            "else": "read_blob"
          }
        }
      }
    },
    {
      "id": "read_blob",
      "name": "Read Blob",
      "type": "packagerepo.blob_get",
      "typeVersion": 1,
      "position": [
        400,
        300
      ],
      "parameters": {
        "name": "Read Blob",
        "typeVersion": 1,
        "position": [
          400,
          300
        ],
        "parameters": {
          "parameters": {
            "digest": "$metadata.digest",
            "out": "blob_data"
          }
        }
      }
    },
    {
      "id": "check_blob_exists",
      "name": "Check Blob Exists",
      "type": "logic.if",
      "typeVersion": 1,
      "position": [
        700,
        300
      ],
      "parameters": {
        "name": "Check Blob Exists",
        "typeVersion": 1,
        "position": [
          700,
          300
        ],
        "parameters": {
          "parameters": {
            "condition": "$blob_data == null",
            "then": "error_blob_missing",
            "else": "respond_blob"
          }
        }
      }
    },
    {
      "id": "respond_blob",
      "name": "Respond Blob",
      "type": "packagerepo.respond_blob",
      "typeVersion": 1,
      "position": [
        100,
        500
      ],
      "parameters": {
        "name": "Respond Blob",
        "typeVersion": 1,
        "position": [
          100,
          500
        ],
        "parameters": {
          "parameters": {
            "data": "$blob_data",
            "headers": {
              "Content-Type": "application/octet-stream",
              "Content-Digest": "sha-256=$metadata.digest",
              "Content-Length": "$metadata.size"
            },
            "status": 200
          }
        }
      }
    },
    {
      "id": "error_not_found",
      "name": "Error Not Found",
      "type": "packagerepo.respond_error",
      "typeVersion": 1,
      "position": [
        400,
        500
      ],
      "parameters": {
        "name": "Error Not Found",
        "typeVersion": 1,
        "position": [
          400,
          500
        ],
        "parameters": {
          "parameters": {
            "message": "Artifact not found",
            "status": 404
          }
        }
      }
    },
    {
      "id": "error_blob_missing",
      "name": "Error Blob Missing",
      "type": "packagerepo.respond_error",
      "typeVersion": 1,
      "position": [
        700,
        500
      ],
      "parameters": {
        "name": "Error Blob Missing",
        "typeVersion": 1,
        "position": [
          700,
          500
        ],
        "parameters": {
          "parameters": {
            "message": "Artifact blob data missing",
            "status": 500
          }
        }
      }
    }
  ],
  "connections": {},
  "staticData": {},
  "meta": {},
  "settings": {
    "timezone": "UTC",
    "executionTimeout": 3600,
    "saveExecutionProgress": true,
    "saveDataErrorExecution": "all",
    "saveDataSuccessExecution": "all"
  }
}
