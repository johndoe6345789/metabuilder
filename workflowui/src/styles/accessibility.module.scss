/**
 * Accessibility Styles Module
 * Provides reusable patterns for keyboard focus, high contrast, reduced motion, etc.
 */

// ============================================================================
// Focus Styles (WCAG AAA - 2.4.7 Focus Visible)
// ============================================================================

@mixin focus-visible {
  outline: 3px solid #4f46e5;
  outline-offset: 2px;
  border-radius: 2px;
}

@mixin focus-visible-high-contrast {
  outline: 3px solid #000;
  outline-offset: 2px;
  border-radius: 2px;
}

// Apply to all interactive elements that can receive focus
::-webkit-focus-visible {
  @include focus-visible;
}

:focus-visible {
  @include focus-visible;
}

// Fallback for browsers without :focus-visible support
.focusVisible {
  @include focus-visible;

  &:focus {
    @include focus-visible;
  }
}

// ============================================================================
// Skip Links (Navigation Bypass - WCAG 2.4.1)
// ============================================================================

.skipLink {
  position: absolute;
  top: -40px;
  left: 0;
  background: #4f46e5;
  color: white;
  padding: 8px 16px;
  z-index: 100;
  text-decoration: none;
  border-radius: 0 0 4px 0;

  &:focus {
    top: 0;
    @include focus-visible;
  }
}

// ============================================================================
// High Contrast Mode Support (WCAG 2.3)
// ============================================================================

@media (prefers-contrast: more) {
  .highContrastBorder {
    border: 2px solid currentColor;
  }

  .highContrastText {
    font-weight: 600;
  }

  .focusVisible,
  :focus-visible {
    @include focus-visible-high-contrast;
  }
}

// ============================================================================
// Reduced Motion Support (WCAG 2.3.3)
// ============================================================================

@media (prefers-reduced-motion: reduce) {
  .animatable,
  .withTransition,
  .withAnimation {
    animation: none !important;
    transition: none !important;
  }

  // Disable all transforms for drag operations in reduced motion mode
  .dragging {
    transform: none !important;
  }

  // Disable canvas zoom animations
  .canvasAnimated {
    animation: none !important;
  }
}

// ============================================================================
// Visible Focus Ring (Always Visible)
// ============================================================================

.visibleFocusRing {
  position: relative;

  &:focus-within::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    border: 3px solid #4f46e5;
    border-radius: inherit;
    pointer-events: none;
  }
}

// ============================================================================
// SR-Only (Screen Reader Only) Text
// ============================================================================

.srOnly {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border-width: 0;
}

// SR-Only but visible on focus
.srOnlyFocusable:focus {
  position: static;
  width: auto;
  height: auto;
  overflow: visible;
  clip: auto;
  white-space: normal;
}

// ============================================================================
// Tooltip Accessibility
// ============================================================================

.tooltipAccessible {
  // Tooltips should use aria-describedby, not just title attribute
  // This class ensures proper styling when aria-describedby is present

  &[aria-describedby] {
    text-decoration: underline dotted;
    cursor: help;
  }
}

.tooltipContent {
  // Tooltip itself should have role="tooltip" and be properly positioned
  position: absolute;
  background: rgba(0, 0, 0, 0.9);
  color: white;
  padding: 8px 12px;
  border-radius: 4px;
  font-size: 14px;
  z-index: 1000;
  white-space: nowrap;

  // Ensure text has sufficient contrast
  @media (prefers-contrast: more) {
    background: #000;
    border: 1px solid #fff;
  }
}

// ============================================================================
// Disabled State Accessibility
// ============================================================================

.disabledInteractive {
  opacity: 0.5;
  cursor: not-allowed;
  pointer-events: none;

  // Still make it keyboard accessible if needed
  &:focus-visible {
    @include focus-visible;
    pointer-events: auto;
  }
}

// ============================================================================
// Color Contrast Helpers
// ============================================================================

.highContrast {
  color: #000;
  background-color: #fff;
}

.highContrastInverted {
  color: #fff;
  background-color: #000;
}

// ============================================================================
// Touch Target Size (WCAG 2.5.5 - Minimum 44x44px)
// ============================================================================

.touchTarget {
  min-width: 44px;
  min-height: 44px;
  display: flex;
  align-items: center;
  justify-content: center;
}

// Smaller touch targets for dense layouts (still 24x24px minimum)
.touchTargetCompact {
  min-width: 24px;
  min-height: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
}

// ============================================================================
// Content Visibility (for performance + accessibility)
// ============================================================================

.contentVisibilityAuto {
  content-visibility: auto;
  contain-intrinsic-size: auto 500px;
}

// Hidden but not from screen readers or keyboard navigation
.visuallyHidden {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}

// ============================================================================
// Live Region Styling
// ============================================================================

.liveRegion {
  // Give visual feedback when content updates
  position: relative;

  &[aria-live='polite'] {
    // Subtle background change to indicate update
    &.updated {
      background-color: rgba(79, 70, 229, 0.1);
      animation: liveRegionUpdate 0.3s ease-in-out;
    }
  }

  &[aria-live='assertive'] {
    // More prominent for assertive updates
    &.updated {
      background-color: rgba(239, 68, 68, 0.1);
      animation: liveRegionUpdate 0.3s ease-in-out;
    }
  }
}

@keyframes liveRegionUpdate {
  0% {
    background-color: transparent;
  }
  50% {
    background-color: rgba(79, 70, 229, 0.15);
  }
  100% {
    background-color: transparent;
  }
}

// ============================================================================
// Form Accessibility
// ============================================================================

.formFieldAccessible {
  display: flex;
  flex-direction: column;
  gap: 4px;

  label {
    font-weight: 500;
    color: rgba(0, 0, 0, 0.87);

    // Required field indicator
    &[aria-required='true']::after {
      content: ' *';
      color: #ef4444;
      font-weight: bold;
    }
  }

  input,
  select,
  textarea {
    &:invalid {
      border-color: #ef4444;
      outline-color: #ef4444;
    }

    &:valid {
      border-color: #10b981;
    }

    &:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
  }

  // Error message styling with proper ARIA
  [role='alert'] {
    color: #ef4444;
    font-size: 14px;
    margin-top: 4px;
  }

  // Help text for descriptions
  [role='doc-subtitle'] {
    color: rgba(0, 0, 0, 0.6);
    font-size: 13px;
    margin-top: 4px;
  }
}

// ============================================================================
// List and Navigation Accessibility
// ============================================================================

.accessibleList {
  list-style: none;
  padding: 0;
  margin: 0;

  li {
    position: relative;

    // Visual indicator for list items
    &::before {
      content: 'â€¢ ';
      margin-right: 8px;
    }

    // Remove bullet for semantic <ul> with role="list"
    &[role='listitem']::before {
      display: none;
    }
  }
}

.accessibleNav {
  ul {
    @extend .accessibleList;
  }

  a {
    position: relative;
    text-decoration: none;
    padding: 8px 4px;

    &:hover {
      text-decoration: underline;
    }

    &:focus-visible {
      @include focus-visible;
    }

    // Skip Link indicator
    &.skipLink {
      @extend .skipLink;
    }
  }
}

// ============================================================================
// Modal/Dialog Accessibility
// ============================================================================

.modalAccessible {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: white;
  border: 1px solid #e5e7eb;
  border-radius: 8px;
  padding: 24px;
  z-index: 50;
  max-width: 90vw;
  max-height: 90vh;
  overflow: auto;

  // When modal is open, body should not scroll
  &[role='dialog'] {
    @media (prefers-reduced-motion: reduce) {
      animation: none;
    }

    @media (prefers-reduced-motion: no-preference) {
      animation: modalFadeIn 0.2s ease-in;
    }
  }

  // Modal title should be properly labeled
  h1,
  h2,
  [role='heading'] {
    margin-top: 0;
    margin-bottom: 16px;
    font-weight: 600;
  }

  // Close button accessibility
  button[aria-label*='close'] {
    position: absolute;
    top: 16px;
    right: 16px;
    background: transparent;
    border: none;
    padding: 8px;
    cursor: pointer;
    font-size: 24px;

    &:focus-visible {
      @include focus-visible;
    }
  }
}

@keyframes modalFadeIn {
  from {
    opacity: 0;
    transform: translate(-50%, -50%) scale(0.95);
  }
  to {
    opacity: 1;
    transform: translate(-50%, -50%) scale(1);
  }
}

.modalBackdrop {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: rgba(0, 0, 0, 0.5);
  z-index: 40;

  // Ensure backdrop doesn't interfere with keyboard
  &:focus {
    outline: none;
  }
}

// ============================================================================
// Loading/Busy States
// ============================================================================

.accessibleBusy {
  position: relative;

  &::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(255, 255, 255, 0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: wait;

    @media (prefers-reduced-motion: reduce) {
      animation: none;
    }

    @media (prefers-reduced-motion: no-preference) {
      animation: spin 1s linear infinite;
    }
  }
}

@keyframes spin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

// ============================================================================
// Status Message Styling
// ============================================================================

.accessibleMessage {
  padding: 12px 16px;
  border-radius: 4px;
  margin: 12px 0;
  border-left: 4px solid currentColor;

  &[role='status'] {
    // Status messages
    background-color: rgba(79, 70, 229, 0.1);
    border-left-color: #4f46e5;
    color: #312e81;
  }

  &[role='alert'] {
    // Alert messages (errors)
    background-color: rgba(239, 68, 68, 0.1);
    border-left-color: #ef4444;
    color: #7f1d1d;
  }

  &[role='alertdialog'] {
    // Dialog alerts (warnings)
    background-color: rgba(251, 146, 60, 0.1);
    border-left-color: #f97316;
    color: #7c2d12;
  }

  &.success {
    background-color: rgba(16, 185, 129, 0.1);
    border-left-color: #10b981;
    color: #065f46;
  }

  &.info {
    background-color: rgba(59, 130, 246, 0.1);
    border-left-color: #3b82f6;
    color: #1e3a8a;
  }

  &.warning {
    background-color: rgba(251, 146, 60, 0.1);
    border-left-color: #f97316;
    color: #7c2d12;
  }

  &.error {
    background-color: rgba(239, 68, 68, 0.1);
    border-left-color: #ef4444;
    color: #7f1d1d;
  }
}

// ============================================================================
// Table Accessibility
// ============================================================================

.accessibleTable {
  width: 100%;
  border-collapse: collapse;
  margin: 12px 0;

  caption {
    text-align: left;
    font-weight: 600;
    margin-bottom: 8px;
  }

  thead {
    background-color: #f3f4f6;
    border-bottom: 2px solid #d1d5db;

    th {
      padding: 12px;
      text-align: left;
      font-weight: 600;
      color: rgba(0, 0, 0, 0.87);
    }
  }

  tbody {
    tr {
      border-bottom: 1px solid #e5e7eb;
      transition: background-color 0.2s;

      &:hover {
        background-color: #f9fafb;
      }

      &:focus-within {
        background-color: rgba(79, 70, 229, 0.05);
        outline: 2px solid #4f46e5;
        outline-offset: -2px;
      }
    }

    td {
      padding: 12px;
    }
  }
}

// ============================================================================
// Utility Classes
// ============================================================================

.flexCenter {
  display: flex;
  align-items: center;
  justify-content: center;
}

.flexColumn {
  display: flex;
  flex-direction: column;
}

.gap4 {
  gap: 4px;
}

.gap8 {
  gap: 8px;
}

.gap12 {
  gap: 12px;
}

.gap16 {
  gap: 16px;
}

.p4 {
  padding: 4px;
}

.p8 {
  padding: 8px;
}

.p12 {
  padding: 12px;
}

.p16 {
  padding: 16px;
}

.rounded4 {
  border-radius: 4px;
}

.rounded8 {
  border-radius: 8px;
}
