# Codegen Studio Schema Definitions
# Package: codegen_studio
# Version: 1.0.0

entities:
  - name: CodegenProject
    description: Code generation project
    fields:
      - name: id
        type: String
        required: true
        primary: true
      - name: tenantId
        type: String
        required: true
      - name: name
        type: String
        required: true
      - name: description
        type: String
        required: false
      - name: language
        type: String
        required: true
        description: Target language (typescript, python, lua, etc.)
      - name: framework
        type: String
        required: false
        description: Target framework
      - name: config
        type: Json
        required: false
        description: Project configuration
      - name: createdAt
        type: DateTime
        required: true
      - name: updatedAt
        type: DateTime
        required: true
    indexes:
      - name: project_tenant_name_idx
        fields: [tenantId, name]
    acl:
      create: [user]
      read: [user, admin]
      update: [owner, admin]
      delete: [owner, admin]

  - name: CodegenBlueprint
    description: Code generation blueprint/template definition
    fields:
      - name: id
        type: String
        required: true
        primary: true
      - name: tenantId
        type: String
        required: true
      - name: projectId
        type: String
        required: true
      - name: name
        type: String
        required: true
      - name: type
        type: String
        required: true
        description: entity, component, service, api, etc.
      - name: spec
        type: Json
        required: true
        description: Blueprint specification
      - name: createdAt
        type: DateTime
        required: true
      - name: updatedAt
        type: DateTime
        required: true
    indexes:
      - name: blueprint_project_idx
        fields: [projectId]
      - name: blueprint_tenant_type_idx
        fields: [tenantId, type]
    relations:
      - name: project
        type: belongsTo
        target: CodegenProject
        foreignKey: projectId
    acl:
      create: [user]
      read: [user, admin]
      update: [owner, admin]
      delete: [owner, admin]

  - name: CodegenTemplate
    description: Code generation template
    fields:
      - name: id
        type: String
        required: true
        primary: true
      - name: tenantId
        type: String
        required: true
      - name: name
        type: String
        required: true
      - name: language
        type: String
        required: true
      - name: type
        type: String
        required: true
        description: Template type (entity, component, etc.)
      - name: template
        type: String
        required: true
        description: Template content with placeholders
      - name: variables
        type: Json
        required: false
        description: Available template variables
      - name: isBuiltin
        type: Boolean
        required: true
        default: false
      - name: createdAt
        type: DateTime
        required: true
      - name: updatedAt
        type: DateTime
        required: true
    indexes:
      - name: template_tenant_lang_type_idx
        fields: [tenantId, language, type]
    acl:
      create: [admin]
      read: [user, admin]
      update: [admin]
      delete: [admin]

  - name: CodegenGeneration
    description: Code generation execution record
    fields:
      - name: id
        type: String
        required: true
        primary: true
      - name: tenantId
        type: String
        required: true
      - name: projectId
        type: String
        required: true
      - name: blueprintId
        type: String
        required: false
      - name: templateId
        type: String
        required: false
      - name: input
        type: Json
        required: true
        description: Generation input parameters
      - name: output
        type: String
        required: false
        description: Generated code
      - name: status
        type: String
        required: true
        description: pending, completed, failed
      - name: error
        type: String
        required: false
      - name: createdAt
        type: DateTime
        required: true
    indexes:
      - name: generation_project_idx
        fields: [projectId]
    relations:
      - name: project
        type: belongsTo
        target: CodegenProject
        foreignKey: projectId
    acl:
      create: [user]
      read: [owner, admin]
      update: [none]
      delete: [owner, admin]
