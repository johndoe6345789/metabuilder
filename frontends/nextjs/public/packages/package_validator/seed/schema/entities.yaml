# Package Validator Schema Definitions
# Package: package_validator
# Version: 1.0.0

entities:
  - name: ValidationRun
    description: Package validation execution record
    fields:
      - name: id
        type: String
        required: true
        primary: true
      - name: tenantId
        type: String
        required: true
      - name: packageName
        type: String
        required: true
      - name: packageVersion
        type: String
        required: false
      - name: status
        type: String
        required: true
        description: pending, running, completed, failed
      - name: results
        type: Json
        required: false
        description: Validation results summary
      - name: startedAt
        type: DateTime
        required: true
      - name: completedAt
        type: DateTime
        required: false
    indexes:
      - name: validation_tenant_package_idx
        fields: [tenantId, packageName]
      - name: validation_status_idx
        fields: [status]
    acl:
      create: [system, admin]
      read: [user, admin]
      update: [system]
      delete: [admin]

  - name: ValidationIssue
    description: Individual validation issue/warning
    fields:
      - name: id
        type: String
        required: true
        primary: true
      - name: runId
        type: String
        required: true
      - name: severity
        type: String
        required: true
        description: error, warning, info
      - name: code
        type: String
        required: true
        description: Issue code for categorization
      - name: message
        type: String
        required: true
      - name: file
        type: String
        required: false
      - name: line
        type: Int
        required: false
      - name: suggestion
        type: String
        required: false
      - name: createdAt
        type: DateTime
        required: true
    indexes:
      - name: issue_run_idx
        fields: [runId]
      - name: issue_severity_idx
        fields: [runId, severity]
    relations:
      - name: run
        type: belongsTo
        target: ValidationRun
        foreignKey: runId
    acl:
      create: [system]
      read: [user, admin]
      update: [none]
      delete: [admin]

  - name: ValidationRule
    description: Custom validation rule definition
    fields:
      - name: id
        type: String
        required: true
        primary: true
      - name: tenantId
        type: String
        required: true
      - name: name
        type: String
        required: true
      - name: code
        type: String
        required: true
        description: Unique rule code
      - name: severity
        type: String
        required: true
      - name: description
        type: String
        required: true
      - name: check
        type: String
        required: true
        description: Lua function body for validation
      - name: enabled
        type: Boolean
        required: true
        default: true
      - name: createdAt
        type: DateTime
        required: true
      - name: updatedAt
        type: DateTime
        required: true
    indexes:
      - name: rule_tenant_code_idx
        fields: [tenantId, code]
        unique: true
    acl:
      create: [admin]
      read: [user, admin]
      update: [admin]
      delete: [admin]
