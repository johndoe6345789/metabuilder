{
  "$schema": "https://metabuilder.dev/schemas/json-script.schema.json",
  "schemaVersion": "2.2.0",
  "package": "complete-example",
  "description": "Business logic functions for complete example package",
  "imports": [
    {
      "from": "@stdlib/string",
      "import": ["trim", "toLowerCase"]
    },
    {
      "from": "@stdlib/validation",
      "import": ["isEmail"]
    }
  ],
  "functions": [
    {
      "id": "get_users",
      "name": "getUsers",
      "exported": true,
      "async": true,
      "params": [
        {
          "name": "page",
          "type": "number",
          "default": 1
        },
        {
          "name": "limit",
          "type": "number",
          "default": 20
        },
        {
          "name": "role",
          "type": "UserRole",
          "optional": true
        }
      ],
      "returnType": "Promise<User[]>",
      "body": [
        {
          "type": "const_declaration",
          "name": "offset",
          "value": {
            "type": "binary_expression",
            "operator": "*",
            "left": {
              "type": "binary_expression",
              "operator": "-",
              "left": {
                "type": "identifier",
                "name": "page"
              },
              "right": {
                "type": "literal",
                "value": 1
              }
            },
            "right": {
              "type": "identifier",
              "name": "limit"
            }
          }
        },
        {
          "type": "const_declaration",
          "name": "users",
          "value": {
            "type": "await_expression",
            "argument": {
              "type": "call_expression",
              "callee": "db.query",
              "args": [
                {
                  "type": "object_literal",
                  "properties": [
                    {
                      "key": "table",
                      "value": {
                        "type": "literal",
                        "value": "users"
                      }
                    },
                    {
                      "key": "limit",
                      "value": {
                        "type": "identifier",
                        "name": "limit"
                      }
                    },
                    {
                      "key": "offset",
                      "value": {
                        "type": "identifier",
                        "name": "offset"
                      }
                    },
                    {
                      "key": "where",
                      "value": {
                        "type": "conditional_expression",
                        "test": {
                          "type": "identifier",
                          "name": "role"
                        },
                        "consequent": {
                          "type": "object_literal",
                          "properties": [
                            {
                              "key": "role",
                              "value": {
                                "type": "identifier",
                                "name": "role"
                              }
                            }
                          ]
                        },
                        "alternate": {
                          "type": "object_literal",
                          "properties": []
                        }
                      }
                    }
                  ]
                }
              ]
            }
          }
        },
        {
          "type": "return",
          "value": {
            "type": "identifier",
            "name": "users"
          }
        }
      ],
      "docstring": {
        "summary": "Retrieves paginated list of users",
        "params": [
          {
            "name": "page",
            "description": "Page number (1-based)"
          },
          {
            "name": "limit",
            "description": "Number of users per page"
          },
          {
            "name": "role",
            "description": "Filter by user role",
            "optional": true
          }
        ],
        "returns": {
          "type": "Promise<User[]>",
          "description": "Array of user objects"
        }
      }
    },
    {
      "id": "get_user",
      "name": "getUser",
      "exported": true,
      "async": true,
      "params": [
        {
          "name": "id",
          "type": "string",
          "sanitize": true
        }
      ],
      "returnType": "Promise<User | null>",
      "body": [
        {
          "type": "const_declaration",
          "name": "user",
          "value": {
            "type": "await_expression",
            "argument": {
              "type": "call_expression",
              "callee": "db.findOne",
              "args": [
                {
                  "type": "literal",
                  "value": "users"
                },
                {
                  "type": "object_literal",
                  "properties": [
                    {
                      "key": "id",
                      "value": {
                        "type": "identifier",
                        "name": "id"
                      }
                    }
                  ]
                }
              ]
            }
          }
        },
        {
          "type": "return",
          "value": {
            "type": "identifier",
            "name": "user"
          }
        }
      ],
      "docstring": {
        "summary": "Retrieves a single user by ID",
        "params": [
          {
            "name": "id",
            "description": "User UUID"
          }
        ],
        "returns": {
          "type": "Promise<User | null>",
          "description": "User object or null if not found"
        }
      }
    },
    {
      "id": "create_user",
      "name": "createUser",
      "exported": true,
      "async": true,
      "params": [
        {
          "name": "input",
          "type": "CreateUserInput",
          "sanitize": true
        }
      ],
      "returnType": "Promise<User>",
      "body": [
        {
          "type": "comment",
          "text": "Validate input"
        },
        {
          "type": "const_declaration",
          "name": "validation",
          "value": {
            "type": "await_expression",
            "argument": {
              "type": "call_expression",
              "callee": "validateUserCreate",
              "args": [
                {
                  "type": "identifier",
                  "name": "input"
                }
              ]
            }
          }
        },
        {
          "type": "if_statement",
          "condition": {
            "type": "unary_expression",
            "operator": "!",
            "argument": {
              "type": "member_access",
              "object": {
                "type": "identifier",
                "name": "validation"
              },
              "property": "valid"
            }
          },
          "then": [
            {
              "type": "throw",
              "argument": {
                "type": "object_literal",
                "properties": [
                  {
                    "key": "code",
                    "value": {
                      "type": "literal",
                      "value": "VALIDATION_ERROR"
                    }
                  },
                  {
                    "key": "errors",
                    "value": {
                      "type": "member_access",
                      "object": {
                        "type": "identifier",
                        "name": "validation"
                      },
                      "property": "errors"
                    }
                  }
                ]
              }
            }
          ]
        },
        {
          "type": "comment",
          "text": "Hash password"
        },
        {
          "type": "const_declaration",
          "name": "passwordHash",
          "value": {
            "type": "await_expression",
            "argument": {
              "type": "call_expression",
              "callee": "bcrypt.hash",
              "args": [
                {
                  "type": "member_access",
                  "object": {
                    "type": "identifier",
                    "name": "input"
                  },
                  "property": "password"
                },
                {
                  "type": "literal",
                  "value": 10
                }
              ]
            }
          }
        },
        {
          "type": "comment",
          "text": "Create user"
        },
        {
          "type": "const_declaration",
          "name": "user",
          "value": {
            "type": "await_expression",
            "argument": {
              "type": "call_expression",
              "callee": "db.create",
              "args": [
                {
                  "type": "literal",
                  "value": "users"
                },
                {
                  "type": "object_literal",
                  "properties": [
                    {
                      "key": "email",
                      "value": {
                        "type": "member_access",
                        "object": {
                          "type": "identifier",
                          "name": "input"
                        },
                        "property": "email"
                      }
                    },
                    {
                      "key": "name",
                      "value": {
                        "type": "member_access",
                        "object": {
                          "type": "identifier",
                          "name": "input"
                        },
                        "property": "name"
                      }
                    },
                    {
                      "key": "passwordHash",
                      "value": {
                        "type": "identifier",
                        "name": "passwordHash"
                      }
                    },
                    {
                      "key": "role",
                      "value": {
                        "type": "literal",
                        "value": "user"
                      }
                    },
                    {
                      "key": "isActive",
                      "value": {
                        "type": "literal",
                        "value": true
                      }
                    }
                  ]
                }
              ]
            }
          }
        },
        {
          "type": "return",
          "value": {
            "type": "identifier",
            "name": "user"
          }
        }
      ],
      "docstring": {
        "summary": "Creates a new user",
        "params": [
          {
            "name": "input",
            "description": "User creation data"
          }
        ],
        "returns": {
          "type": "Promise<User>",
          "description": "Created user object"
        },
        "throws": [
          {
            "type": "ValidationError",
            "description": "When input validation fails"
          }
        ]
      }
    },
    {
      "id": "update_user",
      "name": "updateUser",
      "exported": true,
      "async": true,
      "params": [
        {
          "name": "id",
          "type": "string",
          "sanitize": true
        },
        {
          "name": "updates",
          "type": "Partial<User>",
          "sanitize": true
        }
      ],
      "returnType": "Promise<User>",
      "body": [
        {
          "type": "const_declaration",
          "name": "user",
          "value": {
            "type": "await_expression",
            "argument": {
              "type": "call_expression",
              "callee": "db.update",
              "args": [
                {
                  "type": "literal",
                  "value": "users"
                },
                {
                  "type": "object_literal",
                  "properties": [
                    {
                      "key": "id",
                      "value": {
                        "type": "identifier",
                        "name": "id"
                      }
                    }
                  ]
                },
                {
                  "type": "identifier",
                  "name": "updates"
                }
              ]
            }
          }
        },
        {
          "type": "return",
          "value": {
            "type": "identifier",
            "name": "user"
          }
        }
      ],
      "docstring": {
        "summary": "Updates a user",
        "params": [
          {
            "name": "id",
            "description": "User UUID"
          },
          {
            "name": "updates",
            "description": "Fields to update"
          }
        ],
        "returns": {
          "type": "Promise<User>",
          "description": "Updated user object"
        }
      }
    },
    {
      "id": "delete_user",
      "name": "deleteUser",
      "exported": true,
      "async": true,
      "params": [
        {
          "name": "id",
          "type": "string",
          "sanitize": true
        }
      ],
      "returnType": "Promise<void>",
      "body": [
        {
          "type": "expression_statement",
          "expression": {
            "type": "await_expression",
            "argument": {
              "type": "call_expression",
              "callee": "db.softDelete",
              "args": [
                {
                  "type": "literal",
                  "value": "users"
                },
                {
                  "type": "object_literal",
                  "properties": [
                    {
                      "key": "id",
                      "value": {
                        "type": "identifier",
                        "name": "id"
                      }
                    }
                  ]
                }
              ]
            }
          }
        }
      ],
      "docstring": {
        "summary": "Soft deletes a user",
        "params": [
          {
            "name": "id",
            "description": "User UUID"
          }
        ],
        "returns": {
          "type": "Promise<void>",
          "description": "No return value"
        }
      }
    }
  ],
  "exports": {
    "functions": ["getUsers", "getUser", "createUser", "updateUser", "deleteUser"]
  }
}
